<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <title>{% if activity %}{{ activity.title }} - {% endif %}Ho·∫°t ƒë·ªông - Gia Ph·∫£ Nguy·ªÖn Ph∆∞·ªõc T·ªôc</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/main.css">
  <style>
    .article-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      margin-bottom: var(--space-6);
      padding: var(--space-3) var(--space-4);
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      text-decoration: none;
      color: var(--color-primary);
      font-weight: var(--font-weight-semibold);
      transition: all var(--transition-base);
    }
    
    .back-link:hover {
      background: var(--color-bg);
      transform: translateX(-4px);
    }
    
    .article-card {
      margin-bottom: var(--space-10);
    }
    
    .article-header {
      padding: var(--space-8);
      border-bottom: 1px solid var(--color-border);
      max-width: 100%;
    }
    
    .article-meta {
      font-size: var(--font-size-sm);
      color: var(--color-text-muted);
      margin-bottom: var(--space-4);
    }
    
    .article-title {
      font-size: var(--font-size-3xl);
      color: var(--color-primary);
      margin-bottom: 0;
      line-height: var(--line-height-tight);
    }
    
    .article-content {
      padding: var(--space-8);
      font-size: var(--font-size-lg);
      line-height: var(--line-height-relaxed);
      color: var(--color-text);
      white-space: pre-wrap;
      max-width: 100%;
      width: 100%;
    }
    
    .article-content > div:first-of-type {
      margin-top: 0;
    }
    
    .article-thumbnail {
      margin-bottom: 16px;
      text-align: center;
    }
    
    .article-thumbnail img {
      width: 100%;
      max-width: 1200px;
      height: auto;
      border-radius: var(--radius-lg);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin: 0 auto;
      display: block;
    }
    
    .article-images {
      margin-top: 16px;
      margin-bottom: 16px;
    }
    
    .article-images .image-item {
      margin-bottom: 12px;
      text-align: center;
    }
    
    .article-images .image-item:last-child {
      margin-bottom: 0;
    }
    
    .article-images .image-item img {
      width: 100%;
      max-width: 1200px;
      height: auto;
      border-radius: var(--radius-lg);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: transform 0.2s ease;
      margin: 0 auto;
      display: block;
    }
    
    .article-images .image-item img:hover {
      transform: scale(1.02);
    }
    
    .related-section {
      margin-top: var(--space-10);
      padding-top: var(--space-8);
      border-top: 2px solid var(--color-border);
    }
    
    .related-title {
      color: var(--color-primary);
      margin-bottom: var(--space-6);
      font-size: var(--font-size-2xl);
    }
    
    .related-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-5);
    }
    
    .related-card {
      text-decoration: none;
      color: inherit;
      display: block;
    }
    
    .related-card h3 {
      color: var(--color-primary);
      font-size: var(--font-size-lg);
      margin-bottom: var(--space-2);
      line-height: var(--line-height-tight);
    }
    
    .related-card .meta {
      font-size: var(--font-size-xs);
      color: var(--color-text-muted);
      margin-bottom: var(--space-2);
    }
    
    .related-card .summary {
      font-size: var(--font-size-sm);
      color: var(--color-text);
      line-height: var(--line-height-relaxed);
    }
    
    @media (max-width: 767px) {
      .article-container {
        padding: 0 15px;
      }
      .article-title {
        font-size: var(--font-size-2xl);
      }
      .article-header, .article-content {
        padding: var(--space-6);
      }
      .related-grid {
        grid-template-columns: 1fr;
      }
      .article-thumbnail img,
      .article-images .image-item img {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <a href="/" class="navbar-logo">Ph√≤ng Tuy Bi√™n Qu·∫≠n C√¥ng ‚Äì Gia Ph·∫£ Nguy·ªÖn Ph∆∞·ªõc T·ªôc</a>
    <button class="navbar-toggle" onclick="toggleNavbar()">‚ò∞</button>
    <ul class="navbar-menu" id="navbarMenu">
      <li><a href="/">Trang ch·ªß</a></li>
      <li><a href="/genealogy">Gia ph·∫£</a></li>
      <li><a href="/activities" class="active">Ho·∫°t ƒë·ªông</a></li>
      <li><a href="/members">Th√†nh vi√™n</a></li>
      <li><a href="/contact">Li√™n h·ªá</a></li>
      <li><a href="/documents">T√†i li·ªáu</a></li>
      <li><a href="/vr-tour">VR Tour</a></li>
      <li><a href="/admin/activities">ƒêƒÉng nh·∫≠p b√†i ƒëƒÉng</a></li>
    </ul>
  </nav>

  <div class="container section">
    <div class="article-container">
      {% if error %}
        <div class="card">
          <div class="empty-state">
            <div class="empty-state-icon">‚ö†Ô∏è</div>
            <h2 class="empty-state-title">L·ªói</h2>
            <p class="empty-state-text">{{ error }}</p>
            <a href="/activities" class="btn btn-primary mt-6">‚Üê Quay l·∫°i danh s√°ch</a>
          </div>
        </div>
      {% elif activity %}
        <a href="/activities" class="back-link">‚Üê Quay l·∫°i danh s√°ch</a>
        
        <article class="card article-card">
          <div class="article-header">
            <div class="article-meta">
              {% if activity.created_at %}
                üìÖ {% if activity.created_at is string %}{{ activity.created_at[:16] }}{% else %}{{ activity.created_at.strftime('%d/%m/%Y %H:%M') }}{% endif %}
              {% endif %}
            </div>
            <h1 class="article-title">{{ activity.title or 'Kh√¥ng c√≥ ti√™u ƒë·ªÅ' }}</h1>
          </div>
          <div class="article-content">
            {% if activity.thumbnail %}
              <div class="article-thumbnail">
                <img src="{{ activity.thumbnail }}" alt="{{ activity.title }}" onclick="window.open(this.src, '_blank')">
              </div>
            {% endif %}
            
            <div style="max-width: 100%; word-wrap: break-word; overflow-wrap: break-word; line-height: 1.8; margin-top: {% if activity.thumbnail %}12px{% else %}0{% endif %}; margin-bottom: 16px;">
              {{ (activity.content or activity.summary or '') | replace('\n', '<br>') | safe }}
            </div>
            
            {% if activity.images %}
              {% set images_list = activity.images if activity.images is iterable and activity.images is not string else [] %}
              {% if images_list|length > 0 %}
                <div class="article-images">
                  {% for img_url in images_list %}
                    {% if img_url %}
                      <div class="image-item">
                        <img src="{{ img_url }}" alt="·∫¢nh minh h·ªça {{ loop.index }}" 
                             onerror="console.error('Failed to load image:', this.src); this.style.display='none';" 
                             onclick="window.open(this.src, '_blank')">
                      </div>
                    {% endif %}
                  {% endfor %}
                </div>
              {% else %}
                <div style="display:none;" id="debug-images">
                  <p>Images list is empty. Raw data: {{ activity.images }}</p>
                </div>
              {% endif %}
            {% else %}
              <div style="display:none;" id="debug-no-images">
                <p>No images field in activity data</p>
              </div>
            {% endif %}
          </div>
        </article>

        {% if related_activities and related_activities|length > 0 %}
          <div class="related-section">
            <h2 class="related-title">Tin li√™n quan</h2>
            <div class="related-grid">
              {% for related in related_activities %}
                <a href="/activities/{{ related.activity_id }}" class="related-card">
                  <div class="card">
                    <h3>{{ related.title or 'Kh√¥ng c√≥ ti√™u ƒë·ªÅ' }}</h3>
                    <div class="meta">
                      {% if related.created_at %}
                        üìÖ {% if related.created_at is string %}{{ related.created_at[:10] }}{% else %}{{ related.created_at.strftime('%d/%m/%Y') }}{% endif %}
                      {% endif %}
                    </div>
                    <div class="summary">
                      {{ (related.summary or '')[:120] }}{% if related.summary and related.summary|length > 120 %}...{% endif %}
                    </div>
                  </div>
                </a>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      {% else %}
        <div class="card">
          <div class="empty-state">
            <div class="empty-state-icon">üì≠</div>
            <h2 class="empty-state-title">Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt</h2>
            <p class="empty-state-text">B√†i vi·∫øt b·∫°n ƒëang t√¨m c√≥ th·ªÉ ƒë√£ b·ªã x√≥a ho·∫∑c ch∆∞a ƒë∆∞·ª£c xu·∫•t b·∫£n.</p>
            <a href="/activities" class="btn btn-primary mt-6">‚Üê Quay l·∫°i danh s√°ch</a>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
  
  <script src="/static/js/common.js"></script>
</body>
</html>

